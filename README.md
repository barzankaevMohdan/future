# Cafe Face Presence System

Полностью рабочий минимальный прототип системы учёта присутствия сотрудников по лицу.

## Структура

- `backend/` — Node.js + Express + SQLite
  - хранит сотрудников и события `IN/OUT`
  - отдаёт API для фронта и сервиса распознавания
- `frontend/` — Vue 3 + Vite SPA
  - панель для добавления сотрудников, просмотра присутствия и событий
- `recognition/` — Python-сервис распознавания
  - берёт фото сотрудников из backend
  - читает поток с камеры
  - распознаёт лица и шлёт события `IN/OUT` в backend

## Требования

- Node.js 18+
- Python 3.10+
- Камера, доступная системе (webcam; используется индекс 0 по умолчанию)
- ОС: Linux / macOS / Windows (для face_recognition на Windows нужны готовые бинарники dlib или компилятор)

## Запуск backend

```bash
cd backend
npm install
npm start
```

Backend поднимется на `http://localhost:3000`.

Проверка:

```bash
curl http://localhost:3000/api/health
```

## Запуск frontend

В отдельном терминале:

```bash
cd frontend
npm install
npm run dev
```

По умолчанию Vite поднимет фронт на `http://localhost:5173`.

Фронт ожидает backend на `http://localhost:3000` (захардкожено в коде, чтобы не усложнять конфиг).

## Запуск сервиса распознавания

В третьем терминале:

```bash
cd recognition
python -m venv venv
# Windows:
# venv\Scripts\activate
# Linux/macOS:
source venv/bin/activate

pip install -r requirements.txt
python main.py
```

По умолчанию сервис:

- берёт backend по адресу `http://localhost:3000`
- открывает камеру с индексом `0`

Можно переопределить через переменные окружения:

```bash
BACKEND_URL=http://localhost:3000 CAMERA_INDEX=0 python main.py
```

## Использование

1. Открой `http://localhost:5173` в браузере.
2. В блоке «Добавить сотрудника»:
   - укажи имя,
   - при желании роль,
   - загрузи фото (желательно крупный портрет с хорошо видимым лицом),
   - нажми «Добавить сотрудника».
3. После добавления первых сотрудников **перезапусти сервис распознавания**, чтобы он забрал фото и сформировал эмбеддинги.
4. Поставь камеру так, чтобы рабочее место попадало в кадр.
5. Когда сотрудник подходит к камере, сервис распознавания:
   - находит его лицо,
   - сравнивает с базой,
   - при устойчивом обнаружении шлёт событие `IN`,
   - при исчезновении из кадра — событие `OUT`.
6. На фронте:
   - в блоке «Сотрудники и присутствие» видно, кто сейчас «На месте»,
   - в блоке «Последние события» — история `IN/OUT` с временем.

## Важно

- Это прототип **для одного рабочего места / зоны** (одна камера).
- Для добавления новых сотрудников пока нужно перезапускать сервис распознавания, чтобы он подхватил новые фото.
- Логика зон и нескольких камер не реализована, но архитектура позволяет дорастить это сверху.
- Для реального бизнеса не забудь:
  - взять письменное согласие сотрудников на обработку биометрических данных,
  - соблюсти местное законодательство по видеонаблюдению и персональным данным.
